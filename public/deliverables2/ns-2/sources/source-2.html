


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > AchievementManager</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">io.github.glitchgobblers.achievements</a>
</div>

<h1>Coverage Summary for Class: AchievementManager (io.github.glitchgobblers.achievements)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AchievementManager</td>
<td class="coverageStat">
  <span class="percent">
    76.5%
  </span>
  <span class="absValue">
    (13/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    37.5%
  </span>
  <span class="absValue">
    (15/40)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    53.7%
  </span>
  <span class="absValue">
    (72/134)
  </span>
</td>
</tr>
  <tr>
    <td class="name">AchievementManager$Popup</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    77.8%
  </span>
  <span class="absValue">
    (14/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    37.5%
  </span>
  <span class="absValue">
    (15/40)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    54.4%
  </span>
  <span class="absValue">
    (74/136)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package io.github.glitchgobblers.achievements;
&nbsp;
&nbsp;import com.badlogic.gdx.Gdx;
&nbsp;import com.badlogic.gdx.files.FileHandle;
&nbsp;import com.badlogic.gdx.graphics.Color;
&nbsp;import com.badlogic.gdx.graphics.Pixmap;
&nbsp;import com.badlogic.gdx.graphics.Texture;
&nbsp;import com.badlogic.gdx.graphics.g2d.BitmapFont;
&nbsp;import com.badlogic.gdx.graphics.g2d.GlyphLayout;
&nbsp;import com.badlogic.gdx.graphics.g2d.SpriteBatch;
&nbsp;import com.badlogic.gdx.math.Matrix4;
&nbsp;import com.badlogic.gdx.utils.Array;
&nbsp;import com.badlogic.gdx.utils.ObjectMap;
&nbsp;import io.github.glitchgobblers.YettiGame;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;
&nbsp;
&nbsp;public class AchievementManager {
&nbsp;  private static final float POPUP_DURATION = 3f;
&nbsp;  private static final float POPUP_PADDING = 12f;
&nbsp;  private static final float POPUP_ICON_SIZE = 48f;
&nbsp;
<b class="fc">&nbsp;  private final Array&lt;Achievement&gt; achievements = new Array&lt;&gt;();</b>
<b class="fc">&nbsp;  private final ObjectMap&lt;String, Texture&gt; iconCache = new ObjectMap&lt;&gt;();</b>
&nbsp;  private final Texture fallbackIcon;
<b class="fc">&nbsp;  private final Array&lt;Popup&gt; popups = new Array&lt;&gt;();</b>
<b class="fc">&nbsp;  private final FileHandle saveFile = Gdx.files.local(&quot;achievements.txt&quot;);</b>
&nbsp;
<b class="fc">&nbsp;  public AchievementManager() {</b>
<b class="fc">&nbsp;    fallbackIcon = createFallbackIcon();</b>
<b class="fc">&nbsp;    defineAll();</b>
<b class="fc">&nbsp;    loadProgress();</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * @return immutable copy of achievements to display in UI.
&nbsp;   */
&nbsp;  public List&lt;Achievement&gt; getAchievements() {
<b class="nc">&nbsp;    List&lt;Achievement&gt; list = new ArrayList&lt;&gt;(achievements.size);</b>
<b class="nc">&nbsp;    achievements.forEach(list::add);</b>
<b class="nc">&nbsp;    return list;</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Unlock an achievement by id. If newly unlocked, persists and queues a popup.
&nbsp;   *
&nbsp;   * @param id the id of the achievement to unlock
&nbsp;   * @param game the game instance
&nbsp;   * @return &lt;code&gt;true&lt;/code&gt; for success, &lt;code&gt;false&lt;/code&gt; for failure (already unlocked or not found)
&nbsp;   */
&nbsp;  public boolean unlock(String id, YettiGame game) {
<b class="fc">&nbsp;    Achievement achievement = find(id);</b>
<b class="pc">&nbsp;    if (achievement == null || achievement.isUnlocked()) {</b>
<b class="fc">&nbsp;      return false;</b>
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    achievement.setUnlocked(true);</b>
<b class="fc">&nbsp;    saveProgress();</b>
<b class="fc">&nbsp;    queuePopup(achievement, game);</b>
<b class="fc">&nbsp;    return true;</b>
&nbsp;  }
&nbsp;
&nbsp;  public boolean isUnlocked(String id) {
<b class="fc">&nbsp;    Achievement achievement = find(id);</b>
<b class="pc">&nbsp;    return achievement != null &amp;&amp; achievement.isUnlocked();</b>
&nbsp;  }
&nbsp;
&nbsp;  /**
&nbsp;   * Render and advance queued popups. Safe to call from any screen.
&nbsp;   *
&nbsp;   * @param game
&nbsp;   * @param batch
&nbsp;   * @param projection
&nbsp;   * @param font
&nbsp;   * @param delta
&nbsp;   */
&nbsp;  public void renderPopups(YettiGame game, SpriteBatch batch, Matrix4 projection, BitmapFont font, float delta) {
<b class="nc">&nbsp;    if (popups.isEmpty()) {</b>
&nbsp;      return;
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    batch.setProjectionMatrix(projection);</b>
<b class="nc">&nbsp;    batch.begin();</b>
<b class="nc">&nbsp;    Array&lt;Popup&gt; toRemove = new Array&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;    for (Popup popup : popups) {</b>
<b class="nc">&nbsp;      popup.elapsed += delta;</b>
<b class="nc">&nbsp;      float t = Math.min(1f, popup.elapsed / POPUP_DURATION);</b>
<b class="nc">&nbsp;      float alpha = 1f - t;</b>
&nbsp;
&nbsp;      // Background box anchored bottom-right
<b class="nc">&nbsp;      float boxW = POPUP_ICON_SIZE + POPUP_PADDING * 3 + popup.textWidth;</b>
<b class="nc">&nbsp;      float boxH = Math.max(POPUP_ICON_SIZE, popup.textHeight) + POPUP_PADDING * 2;</b>
<b class="nc">&nbsp;      float margin = 16f;</b>
<b class="nc">&nbsp;      float worldW = game.viewport.getWorldWidth();</b>
<b class="nc">&nbsp;      float x = worldW - boxW - margin;</b>
<b class="nc">&nbsp;      float y = margin;</b>
&nbsp;
<b class="nc">&nbsp;      Color prevBatchColor = batch.getColor();</b>
<b class="nc">&nbsp;      Color prevFontColor = new Color(font.getColor());</b>
<b class="nc">&nbsp;      batch.setColor(0f, 0f, 0f, 0.65f * alpha);</b>
<b class="nc">&nbsp;      batch.draw(popup.background, x, y, boxW, boxH);</b>
<b class="nc">&nbsp;      batch.setColor(1f, 1f, 1f, alpha);</b>
&nbsp;
&nbsp;      // Icon
<b class="nc">&nbsp;      batch.draw(popup.icon, x + POPUP_PADDING, y + (boxH - POPUP_ICON_SIZE) / 2f, POPUP_ICON_SIZE, POPUP_ICON_SIZE);</b>
&nbsp;
&nbsp;      // Text (title + name stacked)
<b class="nc">&nbsp;      float textX = x + POPUP_PADDING * 2 + POPUP_ICON_SIZE;</b>
<b class="nc">&nbsp;      float textTopY = y + boxH - POPUP_PADDING;</b>
&nbsp;
<b class="nc">&nbsp;      font.setColor(1f, 1f, 1f, alpha);</b>
<b class="nc">&nbsp;      font.draw(batch, popup.titleText, textX, textTopY);</b>
<b class="nc">&nbsp;      font.setColor(prevFontColor);</b>
&nbsp;
<b class="nc">&nbsp;      BitmapFont scaledFont = font;</b>
<b class="nc">&nbsp;      float prevScaleX = scaledFont.getData().scaleX;</b>
<b class="nc">&nbsp;      float prevScaleY = scaledFont.getData().scaleY;</b>
<b class="nc">&nbsp;      scaledFont.getData().setScale(0.9f);</b>
<b class="nc">&nbsp;      scaledFont.setColor(1f, 1f, 1f, alpha);</b>
<b class="nc">&nbsp;      scaledFont.draw(batch, popup.nameText, textX, textTopY - scaledFont.getLineHeight());</b>
<b class="nc">&nbsp;      scaledFont.setColor(prevFontColor);</b>
<b class="nc">&nbsp;      scaledFont.getData().setScale(prevScaleX, prevScaleY);</b>
&nbsp;
<b class="nc">&nbsp;      batch.setColor(prevBatchColor);</b>
&nbsp;
<b class="nc">&nbsp;      if (popup.elapsed &gt;= POPUP_DURATION) {</b>
<b class="nc">&nbsp;        toRemove.add(popup);</b>
&nbsp;      }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    for (Popup popup : toRemove) {</b>
<b class="nc">&nbsp;      popup.background.dispose();</b>
&nbsp;    }
<b class="nc">&nbsp;    popups.removeAll(toRemove, true);</b>
<b class="nc">&nbsp;    batch.end();</b>
&nbsp;  }
&nbsp;
&nbsp;  public Texture getIcon(String id) {
<b class="nc">&nbsp;    return iconCache.get(id, fallbackIcon);</b>
&nbsp;  }
&nbsp;
&nbsp;  // Convenience hooks for future event-based achievements.
&nbsp;  public void markEventTriggered(YettiGame game) {
<b class="fc">&nbsp;    unlock(&quot;event_hunter&quot;, game);</b>
&nbsp;  }
&nbsp;
&nbsp;  public void markAllEventsCompleted(YettiGame game) {
<b class="fc">&nbsp;    unlock(&quot;campus_completionist&quot;, game);</b>
&nbsp;  }
&nbsp;
&nbsp;  public void dispose() {
<b class="nc">&nbsp;    for (Texture texture : iconCache.values()) {</b>
<b class="nc">&nbsp;      texture.dispose();</b>
&nbsp;    }
<b class="nc">&nbsp;    fallbackIcon.dispose();</b>
<b class="nc">&nbsp;    for (Popup popup : popups) {</b>
<b class="nc">&nbsp;      popup.background.dispose();</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  private Achievement find(String id) {
<b class="pc">&nbsp;    for (Achievement achievement : achievements) {</b>
<b class="fc">&nbsp;      if (achievement.getId().equals(id)) {</b>
<b class="fc">&nbsp;        return achievement;</b>
&nbsp;      }
&nbsp;    }
<b class="nc">&nbsp;    return null;</b>
&nbsp;  }
&nbsp;
&nbsp;  private void queuePopup(Achievement achievement, YettiGame game) {
<b class="fc">&nbsp;    Popup popup = new Popup();</b>
<b class="fc">&nbsp;    popup.icon = getTextureWithFallback(achievement.getIconPath(), achievement.getId());</b>
<b class="fc">&nbsp;    popup.titleText = &quot;Achievement&quot;;</b>
<b class="fc">&nbsp;    popup.nameText = achievement.getName();</b>
&nbsp;
<b class="fc">&nbsp;    GlyphLayout layoutTitle = new GlyphLayout(game.fontBorderedSmall, popup.titleText);</b>
<b class="fc">&nbsp;    GlyphLayout layoutName = new GlyphLayout(game.fontSmall, popup.nameText);</b>
<b class="fc">&nbsp;    popup.textWidth = Math.max(layoutTitle.width, layoutName.width);</b>
<b class="fc">&nbsp;    popup.textHeight = layoutTitle.height + layoutName.height + POPUP_PADDING * 0.25f;</b>
&nbsp;
<b class="fc">&nbsp;    popup.background = createBackgroundTexture();</b>
<b class="fc">&nbsp;    popups.add(popup);</b>
&nbsp;  }
&nbsp;
&nbsp;  private void defineAll() {
<b class="fc">&nbsp;    achievements.clear();</b>
<b class="fc">&nbsp;    achievements.add(</b>
&nbsp;        new Achievement(&quot;welcome_campus&quot;, &quot;Welcome to Campus&quot;,
&nbsp;            &quot;Start a run for the first time.&quot;,
&nbsp;            &quot;ui/ach_welcome.png&quot;));
<b class="fc">&nbsp;    achievements.add(</b>
&nbsp;        new Achievement(&quot;pause_once&quot;, &quot;Take a Breather&quot;,
&nbsp;            &quot;Pause the game once.&quot;,
&nbsp;            &quot;ui/ach_pause.png&quot;));
<b class="fc">&nbsp;    achievements.add(</b>
&nbsp;        new Achievement(&quot;caught_by_dean&quot;, &quot;Dean&#39;s Dinner&quot;,
&nbsp;            &quot;Get caught by the Dean.&quot;,
&nbsp;            &quot;ui/ach_dean.png&quot;));
<b class="fc">&nbsp;    achievements.add(</b>
&nbsp;        new Achievement(&quot;times_up&quot;, &quot;Time&#39;s Up&quot;,
&nbsp;            &quot;Run out of time.&quot;,
&nbsp;            &quot;ui/ach_timeout.png&quot;));
<b class="fc">&nbsp;    achievements.add(</b>
&nbsp;        new Achievement(&quot;event_hunter&quot;, &quot;Event Hunter&quot;,
&nbsp;            &quot;Trigger any event.&quot;,
&nbsp;            &quot;ui/ach_event.png&quot;));
<b class="fc">&nbsp;    achievements.add(</b>
&nbsp;        new Achievement(&quot;campus_completionist&quot;, &quot;Campus Completionist&quot;,
&nbsp;            &quot;Trigger all events and finish the level.&quot;,
&nbsp;            &quot;ui/ach_completionist.png&quot;));
&nbsp;
&nbsp;    // Prime icon cache for definitions
<b class="fc">&nbsp;    achievements.forEach(a -&gt; getTextureWithFallback(a.getIconPath(), a.getId()));</b>
&nbsp;  }
&nbsp;
&nbsp;  private void loadProgress() {
<b class="pc">&nbsp;    if (!saveFile.exists()) {</b>
&nbsp;      return;
&nbsp;    }
<b class="nc">&nbsp;    String raw = saveFile.readString();</b>
<b class="nc">&nbsp;    String[] lines = raw.split(&quot;\\r?\\n&quot;);</b>
<b class="nc">&nbsp;    for (String line : lines) {</b>
<b class="nc">&nbsp;      if (line.trim().isEmpty()) {</b>
&nbsp;        continue;
&nbsp;      }
<b class="nc">&nbsp;      String[] parts = line.split(&quot;=&quot;);</b>
<b class="nc">&nbsp;      if (parts.length != 2) {</b>
&nbsp;        continue;
&nbsp;      }
<b class="nc">&nbsp;      String id = parts[0].trim();</b>
<b class="nc">&nbsp;      boolean unlocked = Boolean.parseBoolean(parts[1].trim());</b>
<b class="nc">&nbsp;      Achievement achievement = find(id);</b>
<b class="nc">&nbsp;      if (achievement != null) {</b>
<b class="nc">&nbsp;        achievement.setUnlocked(unlocked);</b>
&nbsp;      }
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  private void saveProgress() {
<b class="fc">&nbsp;    StringBuilder builder = new StringBuilder();</b>
<b class="fc">&nbsp;    for (int i = 0; i &lt; achievements.size; i++) {</b>
<b class="fc">&nbsp;      Achievement a = achievements.get(i);</b>
<b class="fc">&nbsp;      builder.append(a.getId())</b>
<b class="fc">&nbsp;          .append(&quot;=&quot;)</b>
<b class="fc">&nbsp;          .append(a.isUnlocked());</b>
<b class="fc">&nbsp;      if (i &lt; achievements.size - 1) {</b>
<b class="fc">&nbsp;        builder.append(System.lineSeparator());</b>
&nbsp;      }
&nbsp;    }
<b class="fc">&nbsp;    String contents = builder.toString();</b>
<b class="fc">&nbsp;    saveFile.writeString(contents, false);</b>
&nbsp;  }
&nbsp;
&nbsp;  private Texture getTextureWithFallback(String path, String cacheKey) {
<b class="fc">&nbsp;    if (iconCache.containsKey(cacheKey)) {</b>
<b class="fc">&nbsp;      return iconCache.get(cacheKey);</b>
&nbsp;    }
&nbsp;
<b class="pc">&nbsp;    if (Gdx.files.internal(path).exists()) {</b>
<b class="fc">&nbsp;      Texture texture = new Texture(path);</b>
<b class="fc">&nbsp;      iconCache.put(cacheKey, texture);</b>
<b class="fc">&nbsp;      return texture;</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    return fallbackIcon;</b>
&nbsp;  }
&nbsp;
&nbsp;  private Texture createFallbackIcon() {
<b class="fc">&nbsp;    Pixmap pixmap = new Pixmap(32, 32, Pixmap.Format.RGBA8888);</b>
<b class="fc">&nbsp;    pixmap.setColor(0.2f, 0.6f, 1f, 1f);</b>
<b class="fc">&nbsp;    pixmap.fill();</b>
<b class="fc">&nbsp;    pixmap.setColor(Color.WHITE);</b>
<b class="fc">&nbsp;    pixmap.drawLine(0, 0, 31, 31);</b>
<b class="fc">&nbsp;    pixmap.drawLine(0, 31, 31, 0);</b>
<b class="fc">&nbsp;    Texture texture = new Texture(pixmap);</b>
<b class="fc">&nbsp;    pixmap.dispose();</b>
<b class="fc">&nbsp;    return texture;</b>
&nbsp;  }
&nbsp;
&nbsp;  private Texture createBackgroundTexture() {
<b class="fc">&nbsp;    Pixmap pixmap = new Pixmap(1, 1, Pixmap.Format.RGBA8888);</b>
<b class="fc">&nbsp;    pixmap.setColor(Color.WHITE);</b>
<b class="fc">&nbsp;    pixmap.fill();</b>
<b class="fc">&nbsp;    Texture texture = new Texture(pixmap);</b>
<b class="fc">&nbsp;    pixmap.dispose();</b>
<b class="fc">&nbsp;    return texture;</b>
&nbsp;  }
&nbsp;
<b class="fc">&nbsp;  private static class Popup {</b>
&nbsp;    Texture icon;
&nbsp;    Texture background;
&nbsp;    String titleText;
&nbsp;    String nameText;
&nbsp;    float textWidth;
&nbsp;    float textHeight;
<b class="fc">&nbsp;    float elapsed = 0f;</b>
&nbsp;  }
&nbsp;}
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-01-02 16:28</div>
</div>
</body>
</html>
